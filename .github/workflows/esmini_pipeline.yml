name: Esmini Demo Pipeline

on:
  push:
    branches: [ "main" ]      # change to "master" if your default branch is master
  workflow_dispatch:           # lets you run manually from Actions tab

jobs:
  run-esmini-demo:
    runs-on: ubuntu-latest     # GitHub Linux VM (CI machine)

    steps:
      # 1) Get your repository content
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2) Install tools needed to download and unzip esmini
      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y wget unzip

      # 3) Download esmini Linux demo/binary package
      - name: Download esmini demo package
        run: |
          mkdir esmini_demo
          cd esmini_demo
          # ðŸ‘‰ VERY IMPORTANT:
          #    Replace YOUR_ESMINI_ZIP_URL with the actual ZIP link from
          #    https://github.com/esmini/esmini/releases/latest
          wget "YOUR_ESMINI_ZIP_URL"
          ls

      # 4) Unzip esmini package
      - name: Unzip esmini
        run: |
          cd esmini_demo
          unzip *.zip
          echo "After unzip, contents are:"
          ls

      # 5) Run esmini built-in cut-in demo in headless mode
      - name: Run esmini demo headless
        run: |
          cd esmini_demo
          echo "Listing esmini_demo contents:"
          ls

          # By default the demo zip unzips into a folder named 'esmini'
          # If logs show a different folder name, change 'esmini' below.
          cd esmini

          echo "Listing bin and resources:"
          ls
          ls bin
          ls resources/xosc

          # Run built-in demo scenario (no UI window, only logs)
          ./bin/esmini --headless --osc ./resources/xosc/cut-in.xosc --info_text 1
